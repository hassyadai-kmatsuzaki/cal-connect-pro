# フロントエンド設計書

## 画面一覧

### 1. メッセージテンプレート管理画面
### 2. カレンダー設定画面（拡張）
### 3. 流入経路設定画面（拡張）
### 4. ヒアリングフォーム設定画面（拡張）
### 5. 独立フォーム送信画面（LIFF）
### 6. フォーム送信履歴画面

---

## 1. メッセージテンプレート管理画面

### パス
```
/calendars/{calendar_id}/message-templates
/inflow-sources/{source_id}/message-templates
/hearing-forms/{form_id}/message-templates
```

### 画面構成

```
┌─────────────────────────────────────────────────────────────┐
│ カレンダー: 初回相談 > メッセージテンプレート                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 📝 予約完了メッセージ                          [編集] │ │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │ │
│ │ トリガー: 予約完了時                                   │ │
│ │ 有効: ✓                                                 │ │
│ │                                                          │ │
│ │ プレビュー:                                             │ │
│ │ ┌──────────────────────────────────────────┐           │ │
│ │ │ 💬 こんにちは、山田太郎様                 │           │ │
│ │ │                                           │           │ │
│ │ │ ご予約ありがとうございます！             │           │ │
│ │ └──────────────────────────────────────────┘           │ │
│ │ ┌──────────────────────────────────────────┐           │ │
│ │ │ 🖼️ [画像プレビュー]                       │           │ │
│ │ └──────────────────────────────────────────┘           │ │
│ │ ┌──────────────────────────────────────────┐           │ │
│ │ │ 💬 予約日時: 2025年10月30日 14:00        │           │ │
│ │ │    所要時間: 60分                         │           │ │
│ │ └──────────────────────────────────────────┘           │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 📝 予約確定メッセージ                          [編集] │ │
│ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │ │
│ │ トリガー: 予約確定時                                   │ │
│ │ 有効: ✗                                                 │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│                       [+ 新規テンプレート作成]               │
└─────────────────────────────────────────────────────────────┘
```

### テンプレート編集モーダル

```
┌───────────────────────────────────────────────────────────────┐
│ メッセージテンプレート編集                         [×]       │
├───────────────────────────────────────────────────────────────┤
│                                                                │
│ テンプレート名                                                 │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 予約完了メッセージ                                        │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                                │
│ メッセージタイプ                                               │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 予約完了時 ▼                                              │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                                │
│ 有効化 [✓]                                                     │
│                                                                │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                                │
│ メッセージ構成 (最大5件)                                       │
│                                                                │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 1. [テキスト ▼]                               [↑] [↓] [×] │ │
│ │ ┌────────────────────────────────────────────────────────┐ │ │
│ │ │ こんにちは、{customer_name}様                          │ │ │
│ │ │                                                        │ │ │
│ │ │ ご予約ありがとうございます！                          │ │ │
│ │ └────────────────────────────────────────────────────────┘ │ │
│ │                                                            │ │
│ │ 📎 プレースホルダー挿入                                    │ │
│ │ [{customer_name}] [{reservation_datetime}] [{meet_url}]    │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                                │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 2. [画像 ▼]                                   [↑] [↓] [×] │ │
│ │ ┌────────────────────────────────────────────────────────┐ │ │
│ │ │ [🖼️ 画像プレビュー]                                    │ │ │
│ │ │                                                        │ │ │
│ │ │ [ファイルを選択] または ドラッグ&ドロップ              │ │ │
│ │ └────────────────────────────────────────────────────────┘ │ │
│ │ ℹ️ 推奨サイズ: 1024×1024px、最大10MB                      │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                                │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 3. [テキスト ▼]                               [↑] [↓] [×] │ │
│ │ ┌────────────────────────────────────────────────────────┐ │ │
│ │ │ 予約日時: {reservation_datetime}                       │ │ │
│ │ │ 所要時間: {duration}分                                 │ │ │
│ │ └────────────────────────────────────────────────────────┘ │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                                │
│              [+ メッセージを追加] (残り2件まで追加可能)        │
│                                                                │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                                │
│ プレビュー送信（テスト）                                       │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ テストユーザーLINE ID                                     │ │
│ └──────────────────────────────────────────────────────────┘ │
│                           [プレビュー送信]                     │
│                                                                │
│                        [キャンセル]  [保存]                    │
└───────────────────────────────────────────────────────────────┘
```

### React コンポーネント構成

```typescript
// pages/MessageTemplates/Index.tsx
export const MessageTemplatesPage = () => {
  // テンプレート一覧表示
}

// components/MessageTemplate/TemplateList.tsx
export const TemplateList = ({ templates, onEdit, onDelete }) => {
  // テンプレート一覧コンポーネント
}

// components/MessageTemplate/TemplateCard.tsx
export const TemplateCard = ({ template }) => {
  // 個別テンプレートカード
}

// components/MessageTemplate/TemplateEditor.tsx
export const TemplateEditor = ({ template, onSave, onCancel }) => {
  // テンプレート編集モーダル
}

// components/MessageTemplate/MessageItemEditor.tsx
export const MessageItemEditor = ({ item, index, onUpdate, onDelete, onMove }) => {
  // 個別メッセージアイテム編集
}

// components/MessageTemplate/ImageUploader.tsx
export const ImageUploader = ({ onUpload, value }) => {
  // 画像アップロードコンポーネント
}

// components/MessageTemplate/PlaceholderPicker.tsx
export const PlaceholderPicker = ({ onSelect }) => {
  // プレースホルダー選択UI
}

// components/MessageTemplate/TemplatePreview.tsx
export const TemplatePreview = ({ template, sampleData }) => {
  // プレビュー表示（LINE風UI）
}
```

---

## 2. カレンダー設定画面（拡張）

### パス
```
/calendars/{calendar_id}/settings
```

### 新規タブ追加: メッセージ設定

```
┌─────────────────────────────────────────────────────────────┐
│ [基本設定] [予約設定] [メッセージ設定] [Slack通知]          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ 📱 LINE自動返信設定                                          │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ☑ LINE自動返信を有効にする                              │ │
│ │                                                          │ │
│ │ 予約完了時のメッセージ                                  │ │
│ │ ┌────────────────────────────────────────────────────┐   │ │
│ │ │ テンプレート: 予約完了メッセージ              [選択]│   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ │                              [テンプレートを編集]        │ │
│ │                                                          │ │
│ │ ☑ Google MeetのURLを含める                              │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│ ⏰ リマインド設定                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ☑ LINEリマインドを有効にする                            │ │
│ │                                                          │ │
│ │ 送信タイミング                                          │ │
│ │ ☑ 予約の [1] 日前 午前9時                               │ │
│ │ ☑ 予約の [24] 時間前                                    │ │
│ │                                                          │ │
│ │ リマインドメッセージ                                    │ │
│ │ ┌────────────────────────────────────────────────────┐   │ │
│ │ │ テンプレート: リマインドメッセージ            [選択]│   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ │                              [テンプレートを編集]        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│                                          [キャンセル] [保存] │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. ヒアリングフォーム設定画面（拡張）

### パス
```
/hearing-forms/{form_id}/settings
```

### 新規セクション追加

```
┌─────────────────────────────────────────────────────────────┐
│ [基本設定] [フォーム項目] [送信設定] [通知設定]             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ 📋 独立フォーム送信                                          │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ☑ 予約なしの独立フォーム送信を有効にする                │ │
│ │                                                          │ │
│ │ LIFF URL                                                 │ │
│ │ ┌────────────────────────────────────────────────────┐   │ │
│ │ │ https://liff.line.me/xxx/form/1                    │   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ │                                      [URLをコピー]       │ │
│ │                                                          │ │
│ │ ℹ️ このURLを直接LINEで共有することで、予約なしでフォーム │ │
│ │   のみを送信できます                                     │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│ 📱 自動返信設定                                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ☑ フォーム送信時にLINE自動返信を有効にする              │ │
│ │                                                          │ │
│ │ 送信完了メッセージ                                      │ │
│ │ ┌────────────────────────────────────────────────────┐   │ │
│ │ │ テンプレート: フォーム送信完了メッセージ      [選択]│   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ │                              [テンプレートを編集]        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│ 🔔 Slack通知設定                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ☑ フォーム送信時にSlack通知を送信する                   │ │
│ │                                                          │ │
│ │ Webhook URL                                              │ │
│ │ ┌────────────────────────────────────────────────────┐   │ │
│ │ │ https://hooks.slack.com/services/...               │   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ │                                                          │ │
│ │ 通知メッセージ                                          │ │
│ │ ┌────────────────────────────────────────────────────┐   │ │
│ │ │ 📝 新しいフォーム送信がありました                  │   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ │                              [テスト通知を送信]          │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│                                          [キャンセル] [保存] │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 独立フォーム送信画面（LIFF）

### パス
```
/liff/form/{form_id}?source={source_key}
```

### 画面構成

```
┌─────────────────────────────────────┐
│                                      │
│         [会社ロゴ]                   │
│                                      │
│     お問い合わせフォーム             │
│                                      │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                      │
│ お名前 *                             │
│ ┌──────────────────────────────────┐ │
│ │                                  │ │
│ └──────────────────────────────────┘ │
│                                      │
│ メールアドレス *                     │
│ ┌──────────────────────────────────┐ │
│ │                                  │ │
│ └──────────────────────────────────┘ │
│                                      │
│ 電話番号                             │
│ ┌──────────────────────────────────┐ │
│ │                                  │ │
│ └──────────────────────────────────┘ │
│                                      │
│ お問い合わせ内容 *                   │
│ ┌──────────────────────────────────┐ │
│ │                                  │ │
│ │                                  │ │
│ │                                  │ │
│ └──────────────────────────────────┘ │
│                                      │
│        [送信する]                    │
│                                      │
└─────────────────────────────────────┘
```

### 送信完了画面

```
┌─────────────────────────────────────┐
│                                      │
│             ✅                       │
│                                      │
│   フォームを送信しました！           │
│                                      │
│   ご回答ありがとうございます。       │
│   LINEメッセージをご確認ください。   │
│                                      │
│        [閉じる]                      │
│                                      │
└─────────────────────────────────────┘
```

### React コンポーネント

```typescript
// pages/LIFF/FormSubmit.tsx
export const LIFFFormSubmit = () => {
  const { formId } = useParams();
  const [form, setForm] = useState<HearingForm | null>(null);
  const [answers, setAnswers] = useState<Record<string, string>>({});
  const [submitted, setSubmitted] = useState(false);

  // LIFF初期化
  useEffect(() => {
    liff.init({ liffId: process.env.REACT_APP_LIFF_ID });
  }, []);

  // フォーム送信
  const handleSubmit = async () => {
    const profile = await liff.getProfile();
    await api.submitForm(formId, {
      line_user_id: profile.userId,
      answers
    });
    setSubmitted(true);
  };

  if (submitted) {
    return <FormSubmitSuccess />;
  }

  return (
    <FormBuilder 
      form={form} 
      answers={answers}
      onChange={setAnswers}
      onSubmit={handleSubmit}
    />
  );
};
```

---

## 5. フォーム送信履歴画面

### パス
```
/hearing-forms/{form_id}/submissions
```

### 画面構成

```
┌─────────────────────────────────────────────────────────────────────┐
│ フォーム送信履歴: お問い合わせフォーム                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│ フィルター: [すべて ▼] 期間: [今月 ▼]  [検索]                       │
│                                                                      │
│ ┌──────────────────────────────────────────────────────────────────┐ │
│ │ 送信日時          │ 送信者        │ 流入経路      │ Slack │ 操作 │ │
│ ├──────────────────────────────────────────────────────────────────┤ │
│ │ 2025/10/30 14:30 │ 山田太郎      │ Instagram広告 │  ✓   │ [詳細]│ │
│ │ 2025/10/30 13:15 │ 佐藤花子      │ LINE友達追加  │  ✓   │ [詳細]│ │
│ │ 2025/10/30 11:45 │ 田中一郎      │ 公式サイト    │  ✓   │ [詳細]│ │
│ │ 2025/10/29 16:20 │ 鈴木次郎      │ Instagram広告 │  ✗   │ [詳細]│ │
│ └──────────────────────────────────────────────────────────────────┘ │
│                                                                      │
│                            << 1 2 3 4 5 >>                           │
│                                                                      │
│ 📊 統計情報                                                          │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│ 総送信数: 124件  │  今月: 45件  │  今週: 12件  │  今日: 3件        │
└─────────────────────────────────────────────────────────────────────┘
```

### 詳細モーダル

```
┌─────────────────────────────────────────────────────┐
│ フォーム送信詳細                          [×]       │
├─────────────────────────────────────────────────────┤
│                                                      │
│ 送信ID: #123                                         │
│ 送信日時: 2025年10月30日 14:30                       │
│                                                      │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                      │
│ 📱 送信者情報                                        │
│ ┌──────────────────────────────────────────────────┐ │
│ │ お名前: 山田太郎                                 │ │
│ │ メール: yamada@example.com                       │ │
│ │ 電話: 090-1234-5678                              │ │
│ │ LINEユーザー: ○ (Taro Yamada)                   │ │
│ │ 流入経路: Instagram広告                          │ │
│ └──────────────────────────────────────────────────┘ │
│                                                      │
│ 📝 回答内容                                          │
│ ┌──────────────────────────────────────────────────┐ │
│ │ Q: お問い合わせ内容を教えてください              │ │
│ │ A: 料金プランについて詳しく知りたいです。        │ │
│ │    特に法人向けプランの詳細をお願いします。      │ │
│ │                                                  │ │
│ │ Q: ご希望の連絡方法                              │ │
│ │ A: メール                                        │ │
│ └──────────────────────────────────────────────────┘ │
│                                                      │
│ 🔔 通知状況                                          │
│ ┌──────────────────────────────────────────────────┐ │
│ │ Slack通知: ✓ 送信済み (2025/10/30 14:30:05)     │ │
│ │ LINE自動返信: ✓ 送信済み (2025/10/30 14:30:03)  │ │
│ └──────────────────────────────────────────────────┘ │
│                                                      │
│                                    [閉じる]          │
└─────────────────────────────────────────────────────┘
```

---

## コンポーネント設計

### 共通コンポーネント

```typescript
// components/Common/DragDropUpload.tsx
export const DragDropUpload = ({ onUpload, accept, maxSize }) => {
  // ドラッグ&ドロップ画像アップロード
}

// components/Common/ImagePreview.tsx
export const ImagePreview = ({ src, alt, onRemove }) => {
  // 画像プレビュー表示
}

// components/Common/PlaceholderInput.tsx
export const PlaceholderInput = ({ value, onChange, placeholders }) => {
  // プレースホルダー付きテキスト入力
}

// components/Common/LINEPreview.tsx
export const LINEPreview = ({ messages }) => {
  // LINE風メッセージプレビュー
}
```

### ページコンポーネント階層

```
pages/
├── MessageTemplates/
│   ├── Index.tsx
│   └── Edit.tsx
├── Calendars/
│   ├── Settings/
│   │   ├── Basic.tsx
│   │   ├── Booking.tsx
│   │   ├── Messaging.tsx (新規)
│   │   └── Slack.tsx
│   └── Show.tsx
├── HearingForms/
│   ├── Settings/
│   │   ├── Basic.tsx
│   │   ├── Items.tsx
│   │   ├── Submission.tsx (新規)
│   │   └── Notification.tsx (新規)
│   └── Submissions/
│       ├── Index.tsx
│       └── Show.tsx
└── LIFF/
    ├── FormSubmit.tsx
    └── FormSuccess.tsx
```

---

## UI/UXガイドライン

### デザインシステム

#### カラーパレット
- **Primary**: `#06C755` (LINE Green)
- **Secondary**: `#00B900`
- **Success**: `#28A745`
- **Warning**: `#FFC107`
- **Error**: `#DC3545`
- **Text**: `#333333`
- **Background**: `#F8F9FA`

#### フォント
- **見出し**: `Noto Sans JP Bold, 16-24px`
- **本文**: `Noto Sans JP Regular, 14px`
- **キャプション**: `Noto Sans JP Regular, 12px`

#### スペーシング
- **XS**: `4px`
- **SM**: `8px`
- **MD**: `16px`
- **LG**: `24px`
- **XL**: `32px`

### アクセシビリティ

- **コントラスト比**: WCAG AA準拠（4.5:1以上）
- **キーボード操作**: Tab、Enter、Escapeで操作可能
- **スクリーンリーダー**: aria-label適切に設定
- **フォーカス表示**: 明確なアウトライン

### レスポンシブデザイン

#### ブレイクポイント
- **Mobile**: `< 768px`
- **Tablet**: `768px - 1024px`
- **Desktop**: `> 1024px`

#### LIFF画面
- モバイルファースト設計
- 縦スクロール前提
- タップしやすいボタンサイズ（最小44×44px）

---

**作成日**: 2025年10月30日  
**バージョン**: 1.0

