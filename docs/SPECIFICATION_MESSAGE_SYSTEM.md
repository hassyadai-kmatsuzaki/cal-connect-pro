# LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ  åŒ…æ‹¬ä»•æ§˜æ›¸

## ğŸ“‹ ç›®æ¬¡
1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [æ©Ÿèƒ½è¦ä»¶](#æ©Ÿèƒ½è¦ä»¶)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
4. [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä»•æ§˜](#ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä»•æ§˜)
5. [é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨æ¡ä»¶](#é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨æ¡ä»¶)
6. [LIFFç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡](#liffç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡)
7. [Slacké€šçŸ¥é€£æº](#slacké€šçŸ¥é€£æº)
8. [APIè¨­è¨ˆ](#apiè¨­è¨ˆ)
9. [å®Ÿè£…ãƒ•ãƒ­ãƒ¼](#å®Ÿè£…ãƒ•ãƒ­ãƒ¼)
10. [ä»Šå¾Œã®æ‹¡å¼µï¼šã‚·ãƒŠãƒªã‚ªæ©Ÿèƒ½](#ä»Šå¾Œã®æ‹¡å¼µã‚·ãƒŠãƒªã‚ªæ©Ÿèƒ½)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ç›®çš„
ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦ã€LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é€šã˜ã¦æŸ”è»Ÿã§å¤šæ§˜ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡ã‚’å®Ÿç¾ã™ã‚‹ã€‚
ãƒ†ã‚­ã‚¹ãƒˆã¨ç”»åƒã‚’çµ„ã¿åˆã‚ã›ãŸæœ€å¤§5ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã€å„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€æµå…¥çµŒè·¯ã€ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ï¼‰ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦è‡ªå‹•é€ä¿¡ã§ãã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½
- âœ… **ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡**: ãƒ†ã‚­ã‚¹ãƒˆ + ç”»åƒï¼ˆæœ€å¤§5ä»¶ï¼‰
- âœ… **ç‹¬ç«‹ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ LIFF**: äºˆç´„ã¨åˆ‡ã‚Šé›¢ã—ãŸãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
- âœ… **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¥è‡ªå‹•è¿”ä¿¡**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€æµå…¥çµŒè·¯ã€ãƒ•ã‚©ãƒ¼ãƒ ã”ã¨
- âœ… **Slacké€šçŸ¥çµ±åˆ**: äºˆç´„ãƒ»ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®é€šçŸ¥
- âœ… **ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ©Ÿèƒ½**: å‹•çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
- âœ… **å°†æ¥å¯¾å¿œ**: ã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹ã®æ®µéšçš„é…ä¿¡

---

## æ©Ÿèƒ½è¦ä»¶

### 1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½

#### 1.1 ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç¨®é¡
- **äºˆç´„å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (Calendar)
- **æµå…¥æ™‚ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (InflowSource)
- **ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (HearingFormç‹¬ç«‹é€ä¿¡)
- **äºˆç´„ç¢ºå®šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (Calendar)
- **ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (Calendar)
- **ã‚­ãƒ£ãƒ³ã‚»ãƒ«é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** (Calendar)

#### 1.2 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®çµ„ã¿åˆã‚ã›ã§æ§‹æˆï¼š
- **ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æœ€å¤§5,000æ–‡å­—
- **ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æœ€å¤§1,024Ã—1,024pxã€JPEG/PNG
- **é †åº**: 1ã€œ5ã®é †ç•ªã§é€ä¿¡
- **æ··åœ¨å¯èƒ½**: ãƒ†ã‚­ã‚¹ãƒˆâ†’ç”»åƒâ†’ãƒ†ã‚­ã‚¹ãƒˆç­‰ã€è‡ªç”±ãªçµ„ã¿åˆã‚ã›

### 2. é€ä¿¡ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

#### 2.1 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ™ãƒ¼ã‚¹è‡ªå‹•è¿”ä¿¡
```
ãƒˆãƒªã‚¬ãƒ¼: äºˆç´„å®Œäº†æ™‚
å¯¾è±¡: äºˆç´„ã‚’è¡Œã£ãŸLINEãƒ¦ãƒ¼ã‚¶ãƒ¼
è¨­å®šå ´æ‰€: calendars.line_auto_reply = true
```

#### 2.2 æµå…¥çµŒè·¯ãƒ™ãƒ¼ã‚¹è‡ªå‹•è¿”ä¿¡
```
ãƒˆãƒªã‚¬ãƒ¼: LIFFåˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ / å‹é”è¿½åŠ æ™‚
å¯¾è±¡: ç‰¹å®šæµå…¥çµŒè·¯ã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
è¨­å®šå ´æ‰€: inflow_sources.enable_welcome_message = true
```

#### 2.3 ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Œäº†è¿”ä¿¡
```
ãƒˆãƒªã‚¬ãƒ¼: ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Œäº†æ™‚ï¼ˆäºˆç´„ãªã—ï¼‰
å¯¾è±¡: ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã—ãŸLINEãƒ¦ãƒ¼ã‚¶ãƒ¼
è¨­å®šå ´æ‰€: hearing_forms.enable_auto_reply = true
```

### 3. ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ©Ÿèƒ½

#### åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
```
{customer_name}         - ãŠå®¢æ§˜å
{customer_email}        - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
{customer_phone}        - é›»è©±ç•ªå·
{reservation_date}      - äºˆç´„æ—¥ï¼ˆä¾‹: 2025å¹´10æœˆ30æ—¥ï¼‰
{reservation_time}      - äºˆç´„æ™‚åˆ»ï¼ˆä¾‹: 14:00ï¼‰
{reservation_datetime}  - äºˆç´„æ—¥æ™‚ï¼ˆä¾‹: 2025å¹´10æœˆ30æ—¥ 14:00ï¼‰
{duration}              - æ‰€è¦æ™‚é–“ï¼ˆåˆ†ï¼‰
{meet_url}              - Google Meet URL
{calendar_name}         - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å
{inflow_source_name}    - æµå…¥çµŒè·¯å
{form_name}             - ãƒ•ã‚©ãƒ¼ãƒ å
{company_name}          - ãƒ†ãƒŠãƒ³ãƒˆå
{today_date}            - ä»Šæ—¥ã®æ—¥ä»˜
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 3.1 æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«: `message_templates`

#### ç›®çš„
å„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€æµå…¥çµŒè·¯ã€ãƒ•ã‚©ãƒ¼ãƒ ï¼‰ã§ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç®¡ç†

```sql
CREATE TABLE message_templates (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    
    -- ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£
    templatable_type VARCHAR(255) NOT NULL,  -- App\Models\Calendar, App\Models\InflowSource, App\Models\HearingForm
    templatable_id BIGINT UNSIGNED NOT NULL,
    
    -- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—
    message_type ENUM(
        'reservation_created',    -- äºˆç´„å®Œäº†
        'reservation_confirmed',  -- äºˆç´„ç¢ºå®š
        'reservation_cancelled',  -- äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        'reminder',               -- ãƒªãƒã‚¤ãƒ³ãƒ‰
        'welcome',                -- ã‚¦ã‚§ãƒ«ã‚«ãƒ 
        'form_submitted'          -- ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Œäº†
    ) NOT NULL,
    
    -- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå
    name VARCHAR(255) NOT NULL,
    description TEXT,
    
    -- æœ‰åŠ¹/ç„¡åŠ¹
    is_active BOOLEAN DEFAULT TRUE,
    
    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    INDEX idx_templatable (templatable_type, templatable_id),
    INDEX idx_message_type (message_type),
    INDEX idx_active (is_active)
);
```

### 3.2 æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«: `message_template_items`

#### ç›®çš„
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã®å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´ ï¼ˆãƒ†ã‚­ã‚¹ãƒˆ or ç”»åƒï¼‰ã‚’ç®¡ç†

```sql
CREATE TABLE message_template_items (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    
    -- æ‰€å±ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    message_template_id BIGINT UNSIGNED NOT NULL,
    
    -- é †åºï¼ˆ1ã€œ5ï¼‰
    order INT NOT NULL DEFAULT 1,
    
    -- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—
    type ENUM('text', 'image') NOT NULL,
    
    -- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    content TEXT NULL,          -- ãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆ
    image_url TEXT NULL,        -- ç”»åƒã®å ´åˆ
    image_preview_url TEXT NULL, -- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URL
    
    -- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æƒ…å ±
    original_filename VARCHAR(255) NULL,
    file_size INT NULL,
    mime_type VARCHAR(100) NULL,
    
    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    FOREIGN KEY (message_template_id) REFERENCES message_templates(id) ON DELETE CASCADE,
    INDEX idx_template_order (message_template_id, order),
    CHECK (order >= 1 AND order <= 5)
);
```

### 3.3 æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°: `hearing_forms`

```sql
ALTER TABLE hearing_forms 
ADD COLUMN enable_auto_reply BOOLEAN DEFAULT FALSE AFTER is_active,
ADD COLUMN slack_notify BOOLEAN DEFAULT FALSE AFTER enable_auto_reply,
ADD COLUMN slack_webhook TEXT NULL AFTER slack_notify,
ADD COLUMN slack_message TEXT NULL AFTER slack_webhook,
ADD COLUMN enable_standalone BOOLEAN DEFAULT FALSE COMMENT 'ç‹¬ç«‹LIFFé€ä¿¡ã‚’æœ‰åŠ¹åŒ–' AFTER slack_message,
ADD COLUMN standalone_liff_url TEXT NULL COMMENT 'ç‹¬ç«‹LIFF URL' AFTER enable_standalone;
```

### 3.4 æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°: `inflow_sources`

```sql
-- welcome_message ã¨ enable_welcome_message ã¯æ—¢å­˜
-- message_templates ã«ç§»è¡Œã™ã‚‹ãŸã‚ã€å°†æ¥çš„ã«å‰Šé™¤äºˆå®šï¼ˆå¾Œæ–¹äº’æ›æ€§ç¶­æŒï¼‰
```

### 3.5 æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«: `form_submissions`

#### ç›®çš„
äºˆç´„ã¨ç´ã¥ã‹ãªã„ç‹¬ç«‹ã—ãŸãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’è¨˜éŒ²

```sql
CREATE TABLE form_submissions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    
    -- ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±
    hearing_form_id BIGINT UNSIGNED NOT NULL,
    
    -- é€ä¿¡è€…æƒ…å ±
    line_user_id BIGINT UNSIGNED NULL,
    inflow_source_id BIGINT UNSIGNED NULL,
    
    -- é€ä¿¡è€…åŸºæœ¬æƒ…å ±
    customer_name VARCHAR(255) NULL,
    customer_email VARCHAR(255) NULL,
    customer_phone VARCHAR(20) NULL,
    
    -- IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
    ip_address VARCHAR(45) NULL,
    user_agent TEXT NULL,
    
    -- Slacké€šçŸ¥çŠ¶æ…‹
    slack_notified_at TIMESTAMP NULL,
    
    -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    FOREIGN KEY (hearing_form_id) REFERENCES hearing_forms(id) ON DELETE CASCADE,
    FOREIGN KEY (line_user_id) REFERENCES line_users(id) ON DELETE SET NULL,
    FOREIGN KEY (inflow_source_id) REFERENCES inflow_sources(id) ON DELETE SET NULL,
    
    INDEX idx_form (hearing_form_id),
    INDEX idx_line_user (line_user_id),
    INDEX idx_submitted_at (submitted_at)
);
```

### 3.6 æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«: `form_submission_answers`

#### ç›®çš„
ç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã®å›ç­”ã‚’è¨˜éŒ²

```sql
CREATE TABLE form_submission_answers (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    
    form_submission_id BIGINT UNSIGNED NOT NULL,
    hearing_form_item_id BIGINT UNSIGNED NOT NULL,
    
    answer_text TEXT NULL,
    
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    FOREIGN KEY (form_submission_id) REFERENCES form_submissions(id) ON DELETE CASCADE,
    FOREIGN KEY (hearing_form_item_id) REFERENCES hearing_form_items(id) ON DELETE CASCADE,
    
    INDEX idx_submission (form_submission_id),
    INDEX idx_item (hearing_form_item_id)
);
```

---

## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä»•æ§˜

### 4.1 LINE Messaging API ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

#### ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```json
{
    "type": "text",
    "text": "ã“ã‚“ã«ã¡ã¯ã€{customer_name}æ§˜\n\nã”äºˆç´„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚"
}
```

#### ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```json
{
    "type": "image",
    "originalContentUrl": "https://example.com/image.jpg",
    "previewImageUrl": "https://example.com/preview.jpg"
}
```

#### è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ä¾‹
```json
{
    "to": "U1234567890abcdef",
    "messages": [
        {
            "type": "text",
            "text": "ã”äºˆç´„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼"
        },
        {
            "type": "image",
            "originalContentUrl": "https://example.com/map.jpg",
            "previewImageUrl": "https://example.com/map_preview.jpg"
        },
        {
            "type": "text",
            "text": "äºˆç´„æ—¥æ™‚: 2025å¹´10æœˆ30æ—¥ 14:00\nä¼šå ´ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ä¸Šè¨˜åœ°å›³ã‚’ã”ç¢ºèªãã ã•ã„ã€‚"
        }
    ]
}
```

### 4.2 ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä»•æ§˜

#### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **ä¿å­˜å…ˆ**: `storage/app/public/line_images/{tenant_id}/`
- **å…¬é–‹URL**: `https://yourdomain.com/storage/line_images/{tenant_id}/{filename}`
- **ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼**: JPEG, PNG
- **æœ€å¤§ã‚µã‚¤ã‚º**: 10MB
- **æ¨å¥¨ã‚µã‚¤ã‚º**: 1024Ã—1024pxï¼ˆæ­£æ–¹å½¢ï¼‰
- **å‘½åè¦å‰‡**: `{timestamp}_{random_string}.{ext}`

#### ç”»åƒå‡¦ç†
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«è‡ªå‹•ãƒªã‚µã‚¤ã‚ºï¼ˆæœ€å¤§1024pxï¼‰
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒè‡ªå‹•ç”Ÿæˆï¼ˆ240Ã—240pxï¼‰
- WebPå½¢å¼ã¸ã®å¤‰æ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥å¯¾å¿œï¼‰

---

## é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨æ¡ä»¶

### 5.1 é€ä¿¡ãƒ•ãƒ­ãƒ¼ä¸€è¦§

| ãƒˆãƒªã‚¬ãƒ¼ | ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ | é€ä¿¡æ¡ä»¶ | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¤ãƒ— |
|---------|------------|---------|-----------------|
| LIFFåˆå›ã‚¢ã‚¯ã‚»ã‚¹ | InflowSource | `enable_welcome_message = true` | `welcome` |
| äºˆç´„å®Œäº† | Calendar | `line_auto_reply = true` | `reservation_created` |
| äºˆç´„ç¢ºå®š | Calendar | ç®¡ç†è€…ãŒç¢ºå®šæ“ä½œ | `reservation_confirmed` |
| ãƒªãƒã‚¤ãƒ³ãƒ‰ | Calendar | `line_remind = true` | `reminder` |
| äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ« | Calendar | ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ“ä½œ | `reservation_cancelled` |
| ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Œäº† | HearingForm | `enable_auto_reply = true` | `form_submitted` |

### 5.2 é€ä¿¡å„ªå…ˆé †ä½

#### äºˆç´„ãƒ•ãƒ­ãƒ¼
1. **æµå…¥æ™‚**: ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆInflowSourceï¼‰
2. **äºˆç´„å®Œäº†**: äºˆç´„å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆCalendarï¼‰
3. **äºˆç´„ç¢ºå®š**: ç¢ºå®šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆCalendarï¼‰
4. **ãƒªãƒã‚¤ãƒ³ãƒ‰**: ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆCalendarï¼‰

#### ç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼
1. **æµå…¥æ™‚**: ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆInflowSourceï¼‰ â€»ä»»æ„
2. **ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Œäº†**: å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆHearingFormï¼‰

---

## LIFFç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡

### 6.1 æ¦‚è¦
äºˆç´„ãƒ—ãƒ­ã‚»ã‚¹ã¨åˆ‡ã‚Šé›¢ã—ã¦ã€ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ã®ã¿ã‚’é€ä¿¡ã§ãã‚‹æ©Ÿèƒ½ã€‚
ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆåé›†ã€å•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã€ã‚¤ãƒ™ãƒ³ãƒˆå‚åŠ ç”³è¾¼ãªã©ã«åˆ©ç”¨ã€‚

### 6.2 URLæ§‹é€ 
```
https://liff.line.me/{liff_id}/form/{form_id}?source={source_key}
```

### 6.3 ãƒ•ãƒ­ãƒ¼
```mermaid
sequenceDiagram
    participant User as LINEãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant LIFF as LIFF App
    participant API as Backend API
    participant LINE as LINE API

    User->>LIFF: ãƒ•ã‚©ãƒ¼ãƒ URLè¨ªå•
    LIFF->>API: ãƒ•ã‚©ãƒ¼ãƒ å–å¾— GET /api/forms/{id}
    API-->>LIFF: ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿è¿”å´
    LIFF->>User: ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
    User->>LIFF: ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãƒ»é€ä¿¡
    LIFF->>API: ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ POST /api/forms/{id}/submit
    API->>API: FormSubmissionä½œæˆ
    API->>LINE: è‡ªå‹•è¿”ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    API->>API: Slacké€šçŸ¥é€ä¿¡ï¼ˆæœ‰åŠ¹æ™‚ï¼‰
    API-->>LIFF: é€ä¿¡å®Œäº†
    LIFF->>User: å®Œäº†ç”»é¢è¡¨ç¤º
    LINE-->>User: è‡ªå‹•è¿”ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
```

### 6.4 API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ•ã‚©ãƒ¼ãƒ å–å¾—
```http
GET /api/tenant/forms/{form_id}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
    "id": 1,
    "name": "ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ",
    "description": "ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„",
    "is_active": true,
    "enable_standalone": true,
    "items": [
        {
            "id": 1,
            "label": "ãŠåå‰",
            "type": "text",
            "required": true,
            "order": 1
        },
        {
            "id": 2,
            "label": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
            "type": "email",
            "required": true,
            "order": 2
        }
    ]
}
```

#### ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
```http
POST /api/tenant/forms/{form_id}/submit
Content-Type: application/json

{
    "line_user_id": "U1234567890abcdef",
    "inflow_source_id": 5,
    "customer_name": "å±±ç”°å¤ªéƒ",
    "customer_email": "yamada@example.com",
    "customer_phone": "090-1234-5678",
    "answers": [
        {
            "hearing_form_item_id": 1,
            "answer_text": "å±±ç”°å¤ªéƒ"
        },
        {
            "hearing_form_item_id": 2,
            "answer_text": "yamada@example.com"
        }
    ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
    "success": true,
    "message": "ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã—ã¾ã—ãŸ",
    "submission_id": 123,
    "auto_reply_sent": true,
    "slack_notified": true
}
```

---

## Slacké€šçŸ¥é€£æº

### 7.1 é€šçŸ¥å¯¾è±¡

#### Calendarï¼ˆæ—¢å­˜ï¼‰
- äºˆç´„ä½œæˆæ™‚
- äºˆç´„ç¢ºå®šæ™‚
- äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚

#### HearingFormï¼ˆæ–°è¦ï¼‰
- ç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚

### 7.2 é€šçŸ¥ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

#### äºˆç´„é€šçŸ¥ï¼ˆCalendarï¼‰
```json
{
    "text": "ğŸ“… æ–°ã—ã„äºˆç´„ãŒå…¥ã‚Šã¾ã—ãŸ",
    "blocks": [
        {
            "type": "header",
            "text": {
                "type": "plain_text",
                "text": "ğŸ“… æ–°ã—ã„äºˆç´„"
            }
        },
        {
            "type": "section",
            "fields": [
                {
                    "type": "mrkdwn",
                    "text": "*ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼:*\nåˆå›ç›¸è«‡"
                },
                {
                    "type": "mrkdwn",
                    "text": "*ãŠå®¢æ§˜:*\nå±±ç”°å¤ªéƒ"
                },
                {
                    "type": "mrkdwn",
                    "text": "*äºˆç´„æ—¥æ™‚:*\n2025å¹´10æœˆ30æ—¥ 14:00"
                },
                {
                    "type": "mrkdwn",
                    "text": "*æµå…¥çµŒè·¯:*\nInstagramåºƒå‘Š"
                }
            ]
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "<https://yourdomain.com/reservations/123|è©³ç´°ã‚’è¦‹ã‚‹>"
            }
        }
    ]
}
```

#### ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡é€šçŸ¥ï¼ˆHearingFormï¼‰
```json
{
    "text": "ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ",
    "blocks": [
        {
            "type": "header",
            "text": {
                "type": "plain_text",
                "text": "ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡"
            }
        },
        {
            "type": "section",
            "fields": [
                {
                    "type": "mrkdwn",
                    "text": "*ãƒ•ã‚©ãƒ¼ãƒ :*\nãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ "
                },
                {
                    "type": "mrkdwn",
                    "text": "*é€ä¿¡è€…:*\nå±±ç”°å¤ªéƒ"
                },
                {
                    "type": "mrkdwn",
                    "text": "*ãƒ¡ãƒ¼ãƒ«:*\nyamada@example.com"
                },
                {
                    "type": "mrkdwn",
                    "text": "*é›»è©±:*\n090-1234-5678"
                }
            ]
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*å›ç­”å†…å®¹:*\n```ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’æ•™ãˆã¦ãã ã•ã„\nâ†’ æ–™é‡‘ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„ã§ã™```"
            }
        },
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "<https://yourdomain.com/forms/submissions/123|è©³ç´°ã‚’è¦‹ã‚‹>"
            }
        }
    ]
}
```

### 7.3 Webhook URLè¨­å®š

#### Calendar
- `calendars.slack_webhook`
- `calendars.slack_notify` = true ã§æœ‰åŠ¹åŒ–

#### HearingForm
- `hearing_forms.slack_webhook`
- `hearing_forms.slack_notify` = true ã§æœ‰åŠ¹åŒ–

---

## APIè¨­è¨ˆ

### 8.1 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† API

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§å–å¾—
```http
GET /api/tenant/message-templates?templatable_type=App\Models\Calendar&templatable_id=1
```

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
```http
POST /api/tenant/message-templates
Content-Type: application/json

{
    "templatable_type": "App\\Models\\Calendar",
    "templatable_id": 1,
    "message_type": "reservation_created",
    "name": "äºˆç´„å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
    "description": "äºˆç´„ãŒå®Œäº†ã—ãŸéš›ã«é€ä¿¡ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
    "is_active": true,
    "items": [
        {
            "order": 1,
            "type": "text",
            "content": "ã“ã‚“ã«ã¡ã¯ã€{customer_name}æ§˜\n\nã”äºˆç´„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼"
        },
        {
            "order": 2,
            "type": "image",
            "image_url": "https://example.com/image.jpg",
            "image_preview_url": "https://example.com/preview.jpg"
        },
        {
            "order": 3,
            "type": "text",
            "content": "äºˆç´„æ—¥æ™‚: {reservation_datetime}\næ‰€è¦æ™‚é–“: {duration}åˆ†"
        }
    ]
}
```

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°
```http
PUT /api/tenant/message-templates/{id}
```

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤
```http
DELETE /api/tenant/message-templates/{id}
```

#### ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
```http
POST /api/tenant/message-templates/upload-image
Content-Type: multipart/form-data

file: [binary]
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
    "success": true,
    "image_url": "https://yourdomain.com/storage/line_images/tenant_1/1730281234_abc123.jpg",
    "preview_url": "https://yourdomain.com/storage/line_images/tenant_1/1730281234_abc123_preview.jpg",
    "filename": "1730281234_abc123.jpg",
    "size": 245678
}
```

### 8.2 ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç† API

#### ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šæ›´æ–°
```http
PUT /api/tenant/hearing-forms/{id}/settings
Content-Type: application/json

{
    "enable_standalone": true,
    "enable_auto_reply": true,
    "slack_notify": true,
    "slack_webhook": "https://hooks.slack.com/services/XXX/YYY/ZZZ",
    "slack_message": "æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãŒã‚ã‚Šã¾ã—ãŸ"
}
```

#### ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å±¥æ­´å–å¾—
```http
GET /api/tenant/form-submissions?hearing_form_id=1&page=1&per_page=20
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
    "data": [
        {
            "id": 123,
            "hearing_form_id": 1,
            "customer_name": "å±±ç”°å¤ªéƒ",
            "customer_email": "yamada@example.com",
            "customer_phone": "090-1234-5678",
            "submitted_at": "2025-10-30T14:30:00Z",
            "slack_notified_at": "2025-10-30T14:30:05Z",
            "answers": [
                {
                    "item_label": "ãŠå•ã„åˆã‚ã›å†…å®¹",
                    "answer_text": "æ–™é‡‘ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„ã§ã™"
                }
            ]
        }
    ],
    "meta": {
        "current_page": 1,
        "per_page": 20,
        "total": 150
    }
}
```

### 8.3 æµå…¥çµŒè·¯ç®¡ç† API

#### ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®š
```http
PUT /api/tenant/inflow-sources/{id}/welcome-message
Content-Type: application/json

{
    "enable_welcome_message": true,
    "template_id": 5  // message_templatesã®ID
}
```

---

## å®Ÿè£…ãƒ•ãƒ­ãƒ¼

### 9.1 å®Ÿè£…é †åº

#### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹ç¯‰ï¼ˆWeek 1ï¼‰
1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
   - `message_templates`
   - `message_template_items`
   - `form_submissions`
   - `form_submission_answers`
   - `hearing_forms` æ›´æ–°

2. ãƒ¢ãƒ‡ãƒ«ä½œæˆ
   - `MessageTemplate`
   - `MessageTemplateItem`
   - `FormSubmission`
   - `FormSubmissionAnswer`

3. ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©

#### Phase 2: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆWeek 2-3ï¼‰
1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† API å®Ÿè£…
2. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½å®Ÿè£…
3. ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç½®æ›ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
4. LINEé€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹æ‹¡å¼µ
5. ç®¡ç†ç”»é¢UIå®Ÿè£…ï¼ˆReactï¼‰

#### Phase 3: ç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼ˆWeek 4ï¼‰
1. ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡APIå®Ÿè£…
2. FormSubmissionãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
3. LIFFç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ä½œæˆ
4. è‡ªå‹•è¿”ä¿¡ãƒ­ã‚¸ãƒƒã‚¯çµ±åˆ

#### Phase 4: Slacké€šçŸ¥æ‹¡å¼µï¼ˆWeek 5ï¼‰
1. HearingForm Slacké€šçŸ¥å®Ÿè£…
2. é€šçŸ¥ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ”¹å–„
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

#### Phase 5: æ—¢å­˜æ©Ÿèƒ½ã®ç§»è¡Œï¼ˆWeek 6ï¼‰
1. æ—¢å­˜ã®å˜ä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ç§»è¡Œ
2. å¾Œæ–¹äº’æ›æ€§ç¶­æŒ
3. ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### Phase 6: ãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´ï¼ˆWeek 7-8ï¼‰
1. å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ
2. çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
3. æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

### 9.2 ä¸»è¦ã‚¯ãƒ©ã‚¹è¨­è¨ˆ

#### MessageTemplate ãƒ¢ãƒ‡ãƒ«
```php
class MessageTemplate extends Model
{
    protected $fillable = [
        'templatable_type',
        'templatable_id',
        'message_type',
        'name',
        'description',
        'is_active',
    ];

    public function templatable(): MorphTo
    public function items(): HasMany
    public function buildMessages(array $data): array
}
```

#### LineMessagingService æ‹¡å¼µ
```php
class LineMessagingService
{
    public function sendTemplate(string $userId, MessageTemplate $template, array $data): bool
    public function sendMultipleMessages(string $userId, array $messages): bool
    private function replacePlaceholders(string $text, array $data): string
    private function buildLineMessages(MessageTemplate $template, array $data): array
}
```

#### FormSubmissionService
```php
class FormSubmissionService
{
    public function submit(HearingForm $form, array $data): FormSubmission
    private function sendAutoReply(FormSubmission $submission): void
    private function sendSlackNotification(FormSubmission $submission): void
}
```

---

## ä»Šå¾Œã®æ‹¡å¼µï¼šã‚·ãƒŠãƒªã‚ªæ©Ÿèƒ½

### 10.1 ã‚·ãƒŠãƒªã‚ªæ©Ÿèƒ½æ¦‚è¦
æ™‚ç³»åˆ—ã«æ²¿ã£ã¦æ®µéšçš„ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é…ä¿¡ã™ã‚‹æ©Ÿèƒ½ã€‚

#### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
- **è‚²æˆã‚·ãƒŠãƒªã‚ª**: åˆå›æ¥è§¦ â†’ 3æ—¥å¾Œ â†’ 1é€±é–“å¾Œ â†’ 2é€±é–“å¾Œ
- **ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—**: äºˆç´„å¾Œ â†’ å‰æ—¥ â†’ å½“æ—¥ â†’ ã‚¢ãƒ•ã‚¿ãƒ¼ãƒ•ã‚©ãƒ­ãƒ¼
- **æ•™è‚²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**: Day 1 â†’ Day 2 â†’ Day 3...

### 10.2 æƒ³å®šãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### scenarios ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE scenarios (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    trigger_type ENUM('manual', 'reservation_created', 'form_submitted', 'tag_added') NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL
);
```

#### scenario_steps ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE scenario_steps (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    scenario_id BIGINT UNSIGNED NOT NULL,
    step_number INT NOT NULL,
    delay_value INT NOT NULL COMMENT 'é…å»¶å€¤',
    delay_unit ENUM('minutes', 'hours', 'days') NOT NULL,
    message_template_id BIGINT UNSIGNED NOT NULL,
    condition_type ENUM('none', 'tag', 'status') NULL,
    condition_value TEXT NULL,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    FOREIGN KEY (scenario_id) REFERENCES scenarios(id) ON DELETE CASCADE,
    FOREIGN KEY (message_template_id) REFERENCES message_templates(id) ON DELETE CASCADE
);
```

#### scenario_executions ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE scenario_executions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    scenario_id BIGINT UNSIGNED NOT NULL,
    line_user_id BIGINT UNSIGNED NOT NULL,
    current_step INT DEFAULT 1,
    status ENUM('active', 'paused', 'completed', 'cancelled') DEFAULT 'active',
    started_at TIMESTAMP NULL,
    completed_at TIMESTAMP NULL,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,
    
    FOREIGN KEY (scenario_id) REFERENCES scenarios(id) ON DELETE CASCADE,
    FOREIGN KEY (line_user_id) REFERENCES line_users(id) ON DELETE CASCADE
);
```

### 10.3 ã‚·ãƒŠãƒªã‚ªå®Ÿè£…æ™‚ã®è€ƒæ…®äº‹é …
- Queueã‚¸ãƒ§ãƒ–ã«ã‚ˆã‚‹é…å»¶å®Ÿè¡Œ
- æ¡ä»¶åˆ†å²ã®ã‚µãƒãƒ¼ãƒˆ
- ABãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- é…ä¿¡åœæ­¢ãƒ»å†é–‹æ©Ÿèƒ½
- åŠ¹æœæ¸¬å®šï¼ˆé–‹å°ç‡ãƒ»ã‚¯ãƒªãƒƒã‚¯ç‡ï¼‰

---

## ã¾ã¨ã‚

### ä¸»è¦æ©Ÿèƒ½
1. âœ… **æŸ”è»Ÿãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡**: ãƒ†ã‚­ã‚¹ãƒˆ + ç”»åƒæœ€å¤§5ä»¶
2. âœ… **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¥è‡ªå‹•è¿”ä¿¡**: Calendar / InflowSource / HearingForm
3. âœ… **ç‹¬ç«‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡**: äºˆç´„ã¨åˆ‡ã‚Šé›¢ã—ãŸã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ»å•ã„åˆã‚ã›
4. âœ… **Slackçµ±åˆ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
5. âœ… **ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼**: å‹•çš„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
6. âœ… **æ‹¡å¼µæ€§**: å°†æ¥ã®ã‚·ãƒŠãƒªã‚ªæ©Ÿèƒ½ã«å¯¾å¿œ

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Backend**: Laravel 11, PHP 8.2+
- **Frontend**: React 18, TypeScript
- **Database**: MySQL 8.0+
- **Queue**: Redis + Laravel Queue
- **Storage**: Laravel Storage (S3å¯¾å¿œå¯)
- **LINE**: Messaging API v2

### é–‹ç™ºæœŸé–“
**ç´„8é€±é–“ï¼ˆ2ãƒ¶æœˆï¼‰**ã‚’æƒ³å®š

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ30æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**ä½œæˆè€…**: Cal-Connect Development Team

